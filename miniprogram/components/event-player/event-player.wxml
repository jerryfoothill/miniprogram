<!-- 聊天界面容器 -->
<view class="chat-page" style="width:100%; margin:0; padding:0;">
    <!-- 顶部标题栏 -->
    <navigation-bar title="{{metadata.opponent.nickname}}" back="{{true}}" delta="1" bindback="onBack">
        <view slot="right">
            <view class="nav-more">
                <view class="nav-more-icon">
                    <view class="nav-more-dot"></view>
                    <view class="nav-more-dot"></view>
                    <view class="nav-more-dot"></view>
                </view>
            </view>
        </view>
    </navigation-bar>
    <!-- 内容区域 -->
    <view class="chat-content full-width-content">
        <!-- 使用chat-container组件 -->
        <chat-container messages="{{formattedMessages}}" selfAvatar="/assets/icons/default-avatar.svg" otherAvatar="{{metadata.opponent.avatarUrl || '/assets/icons/default-avatar.svg'}}" scrollIntoView="{{scrollToView}}" />
    </view>
    <!-- 底部输入区域 -->
    <input-bar value="{{inputText}}" placeholder="输入消息..." disabled="{{!allowInput}}" bindinput="onInputChange" bindsend="onSendMessage" />
    <!-- 控制栏 -->
    <view class="control-bar">
        <view class="control-button" bindtap="onRestart">
            <text>重新开始</text>
        </view>
        <view class="control-button {{isPlaying ? 'pause' : 'play'}}" bindtap="onTogglePlay">
            <text>{{isPlaying ? '暂停' : '播放'}}</text>
        </view>
        <view class="control-button" bindtap="onSkipNext" wx:if="{{!isComplete}}">
            <text>跳过</text>
        </view>
        <view class="control-button disabled" wx:else>
            <text>已完成</text>
        </view>
    </view>
</view>